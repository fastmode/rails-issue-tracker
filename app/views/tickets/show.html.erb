<span class="notice"><%= notice %></span>
<span class="alert"><%= alert %></span>
<div class="row">
  <div class="col-md-6">
    <button type="button" class="btn pull-right btn-default btn-xs" id="js-next" data-id="<%=@ticket.id%>">
      Next Ticket <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
    </button>
    <h3><span class="ticketTitle"><%= @ticket.title %></span></h3>
    <h5>Ticket ID: <span class="ticketId"><%= @ticket.id %></span></h5>
    <h5>Due Date: <span class="ticketDueDate"><%= @ticket.due_date.strftime("%m/%d/%Y") %></span></h5>
    <h5>Location: <span class="ticketLocation"><%= @user_ticket.location %></span></h5>
    <h5>Status: <span class="ticketStatus"><%= @ticket.status %></span></h5>
    <p class="ticketButtons">
      <%= link_to 'Edit Ticket', [:edit, @ticket], :class => 'btn btn-primary btn-xs', :id => "edit-ticket-button" %>
      <%= link_to 'Delete Ticket', ticket_path(@ticket), data: { confirm: 'Are you sure?' }, method: :delete, :class => 'btn btn-danger btn-xs', :id => "delete-ticket-button" %>
    </p><br>
  </div>

  <div class="col-md-6"><br>
    <div class="jumbotron">
      <% if !@issues.empty? %>
        <h4>Issues:</h4>
        <ul class="list-group" id="issue-list">
          <% @issues.each do |issue| %>
          <li class="list-group-item">
            <span class="badge"><%= issue.status %></span>
            <%= link_to issue.title, ticket_issue_path(@ticket, issue)%>
          </li>
          <% end %>
        </ul>
        <%= link_to 'Add Issue', new_ticket_issue_path(@ticket, @issue), :class => 'btn btn-sm pull-right btn-success', :id => 'add-issue-button'%>
      <% else %>
        <br><br><p>No Issues within this Ticket, please add a <%= link_to 'New Issue', new_ticket_issue_path(@ticket, @issue)%>.</p>
      <% end %>
    </div>
  </div>
</div>

<div class="row" id="new-issue-section">
  <div class="col-md-6"></div>
  <div class="col-md-6" id="new-issue-form"><br>

  </div>
</div> 



<script type="text/javascript" charset="utf-8">

  // New Issue Form is Serialized and Posted.  New Issue Section is cleared out.



  $(function () {
    $("#add-issue-button").on("click", function(e) {
      $addIssueButton = $("a#add-issue-button")
      $("a#add-issue-button").remove();               // Removes the Add Issue button
      
      $.get(this.href).success(function(response) {   // Goes out and grabs HTML from this.href
        $("#new-issue-form").html(response);          // Add the New Issue Form to #new-issue-form element in HTML
        
        // New Issue Form is loaded and adds new Issue to <li> after Submitted.
        $('form').submit(function(e){
          var values = $(this).serialize();
          var action = $('form').attr("action");
          var posting = $.post(action, values);

          posting.done(function(data) {
            var li = document.createElement('li');
            li.setAttribute('class', 'list-group-item')
            li.innerHTML = `<span class="badge">${data["status"]}</span><a href="/tickets/${data["ticket_id"]}/issues/${data["id"]}">${data["title"]}</a>`;
            $(".list-group").append(li);                  // Append new issue to <li>
            $("div.jumbotron").append($addIssueButton);   // Append the Add Issue back 
          });
          $("#new-issue-section").text("")                //clears out New Issue form html
          e.preventDefault(); 
        });
      });
      e.preventDefault();
    });

  });
</script>